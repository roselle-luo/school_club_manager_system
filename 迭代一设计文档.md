# 迭代一设计文档

## 1. 概要设计

### 1.1 技术选型说明

| 类别       | 技术    | 版本   | 选型理由                                                |
| :--------- | :------ | :----- | :------------------------------------------------------ |
| 前端框架   | Vue.js  | 3.5.22 | 轻量级、组件化、响应式设计，适合构建现代化单页应用。    |
| 构建工具   | Vite    | 7.1.11 | 快速的开发体验、即时热模块替换，适合Vue 3项目。         |
| 后端语言   | Go      | 1.24   | 编译型语言，性能优异，生态成熟，适合高并发后端服务。    |
| 小程序框架 | uni-app | 最新版 | 跨平台解决方案，支持一次开发多端部署，兼容Vue语法。     |
| 数据库     | MySQL   | 8.0    | 成熟稳定的关系型数据库，适合存储结构化的社团管理数据。  |
| 缓存       | Redis   | 7.0+   | 用于缓存热点数据和管理Session/Token，提升系统响应速度。 |
| API文档    | Swagger | 最新版 | 自动生成API文档，便于前后端协作开发。                   |

### 1.2 架构图

```
+------------------+      +-------------------+      +-------------------+
|                  |      |                   |      |                   |
|  微信小程序端     |      |  Web前端(Vue 3)    |      |  管理后台         |
|  (uni-app)       |      |  (Vite构建)        |      |  (Vue 3)         |
|                  |      |                   |      |                   |
+--------+---------+      +--------+----------+      +--------+----------+
         |                         |                         |
         |                         |                         |
         v                         v                         v
+--------------------------------------------------------------------+
|                          API网关 (可选)                             |
+--------------------------------------------------------------------+
         |
         v
+--------------------------------------------------------------------+
|                    后端服务 (Go)                                   |
|  +-------------+  +-------------+  +-------------+                |
|  |   用户模块   |  |   社团模块   |  |  活动模块    |                |
|  +-------------+  +-------------+  +-------------+                |
|  +-------------+  +-------------+  +-------------+                |
|  |   审批模块   |  |   消息模块   |  |  数据统计    |                |
|  +-------------+  +-------------+  +-------------+                |
+--------------------------------------------------------------------+
         |
         v
+--------------------------------------------------------------------+
|                        数据存储层                                   |
|  +-------------+          +-------------+                          |
|  |   MySQL      |          |   Redis      |                          |
|  +-------------+          +-------------+                          |
+--------------------------------------------------------------------+
```

系统采用经典的三层架构设计：
- **表现层**：包括Web前端、微信小程序和管理后台三个入口，负责用户交互和数据展示。
- **业务逻辑层**：Go后端服务实现核心业务逻辑，包括用户、社团、活动等模块。
- **数据访问层**：MySQL存储持久化数据，Redis提供缓存支持。

### 1.3 数据库设计

#### 主要数据表结构

**1. users (用户表)**
| 字段名        | 数据类型       | 约束                                                    | 描述                                             |
| :------------ | :------------- | :------------------------------------------------------ | :----------------------------------------------- |
| `user_id`     | `BIGINT`       | `PRIMARY KEY, AUTO_INCREMENT`                           | 用户ID                                           |
| `username`    | `VARCHAR(50)`  | `UNIQUE, NOT NULL`                                      | 用户名                                           |
| `password`    | `VARCHAR(255)` | `NOT NULL`                                              | 密码(加密存储)                                   |
| `student_id`  | `VARCHAR(20)`  | `UNIQUE`                                                | 学号                                             |
| `real_name`   | `VARCHAR(50)`  |                                                         | 真实姓名                                         |
| `avatar_url`  | `VARCHAR(255)` |                                                         | 头像URL                                          |
| `phone`       | `VARCHAR(20)`  |                                                         | 手机号                                           |
| `email`       | `VARCHAR(100)` |                                                         | 邮箱                                             |
| `user_type`   | `TINYINT`      | `DEFAULT 0`                                             | 用户类型(0:普通用户, 1:社团管理员, 2:系统管理员) |
| `create_time` | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间                                         |
| `update_time` | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间                                         |

**2. clubs (社团表)**
| 字段名          | 数据类型       | 约束                                                    | 描述                           |
| :-------------- | :------------- | :------------------------------------------------------ | :----------------------------- |
| `club_id`       | `BIGINT`       | `PRIMARY KEY, AUTO_INCREMENT`                           | 社团ID                         |
| `club_name`     | `VARCHAR(100)` | `UNIQUE, NOT NULL`                                      | 社团名称                       |
| `description`   | `TEXT`         |                                                         | 社团描述                       |
| `cover_image`   | `VARCHAR(255)` |                                                         | 封面图片URL                    |
| `founding_date` | `DATE`         |                                                         | 成立日期                       |
| `category`      | `VARCHAR(50)`  |                                                         | 社团类别                       |
| `status`        | `TINYINT`      | `DEFAULT 0`                                             | 状态(0:待审核, 1:正常, 2:禁用) |
| `created_by`    | `BIGINT`       | `FOREIGN KEY REFERENCES users(user_id)`                 | 创建者ID                       |
| `create_time`   | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间                       |
| `update_time`   | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间                       |

**3. club_members (社团成员表)**
| 字段名      | 数据类型    | 约束                                    | 描述                               |
| :---------- | :---------- | :-------------------------------------- | :--------------------------------- |
| `member_id` | `BIGINT`    | `PRIMARY KEY, AUTO_INCREMENT`           | 成员记录ID                         |
| `club_id`   | `BIGINT`    | `FOREIGN KEY REFERENCES clubs(club_id)` | 社团ID                             |
| `user_id`   | `BIGINT`    | `FOREIGN KEY REFERENCES users(user_id)` | 用户ID                             |
| `role`      | `TINYINT`   | `DEFAULT 0`                             | 角色(0:普通成员, 1:副会长, 2:会长) |
| `join_date` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP`             | 加入时间                           |
| `status`    | `TINYINT`   | `DEFAULT 0`                             | 状态(0:待审核, 1:已加入, 2:已退出) |

**4. activities (活动表)**
| 字段名             | 数据类型       | 约束                                                    | 描述                                       |
| :----------------- | :------------- | :------------------------------------------------------ | :----------------------------------------- |
| `activity_id`      | `BIGINT`       | `PRIMARY KEY, AUTO_INCREMENT`                           | 活动ID                                     |
| `club_id`          | `BIGINT`       | `FOREIGN KEY REFERENCES clubs(club_id)`                 | 所属社团ID                                 |
| `title`            | `VARCHAR(200)` | `NOT NULL`                                              | 活动标题                                   |
| `content`          | `TEXT`         |                                                         | 活动内容                                   |
| `start_time`       | `DATETIME`     |                                                         | 开始时间                                   |
| `end_time`         | `DATETIME`     |                                                         | 结束时间                                   |
| `location`         | `VARCHAR(200)` |                                                         | 活动地点                                   |
| `max_participants` | `INT`          |                                                         | 最大参与人数                               |
| `status`           | `TINYINT`      | `DEFAULT 0`                                             | 状态(0:草稿, 1:待审核, 2:进行中, 3:已结束) |
| `created_by`       | `BIGINT`       | `FOREIGN KEY REFERENCES users(user_id)`                 | 创建者ID                                   |
| `create_time`      | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP`                             | 创建时间                                   |
| `update_time`      | `TIMESTAMP`    | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间                                   |

**5. activity_participants (活动参与表)**
| 字段名             | 数据类型    | 约束                                             | 描述                               |
| :----------------- | :---------- | :----------------------------------------------- | :--------------------------------- |
| `participant_id`   | `BIGINT`    | `PRIMARY KEY, AUTO_INCREMENT`                    | 参与记录ID                         |
| `activity_id`      | `BIGINT`    | `FOREIGN KEY REFERENCES activities(activity_id)` | 活动ID                             |
| `user_id`          | `BIGINT`    | `FOREIGN KEY REFERENCES users(user_id)`          | 用户ID                             |
| `participate_time` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP`                      | 报名时间                           |
| `status`           | `TINYINT`   | `DEFAULT 0`                                      | 状态(0:待审核, 1:已确认, 2:已取消) |

#### ER图

```
+----------+        +------------+        +---------------+
|   Users  |        |    Clubs   |        |  Club_Members |
+----------+        +------------+        +---------------+
| user_id  |<----->| club_id    |<----->| member_id     |
| username |        | club_name  |        | club_id       |
| password |        | created_by |        | user_id       |
| user_type|        +------------+        | role          |
+----------+                              +---------------+
      |                                          |
      |                                          |
      v                                          v
+------------------+                     +------------------+
|  Activities      |                     | Activity_Participants |
+------------------+                     +------------------+
| activity_id      |                     | participant_id   |
| club_id          |<--------------------| activity_id      |
| title            |                     | user_id          |
| created_by       |                     | status           |
+------------------+                     +------------------+
```

### 1.4 部署图

```
                      +------------------+
                      |   负载均衡器     |
                      |  (Nginx/云服务)  |
                      +--------+---------+
                               |
           +-------------------+-------------------+
           |                   |                   |
+----------v---------+ +-------v---------+ +--------v---------+
|  Web前端服务器1    | |  Web前端服务器2  | |  Web前端服务器N  |
|  (静态资源/Vite)   | |  (静态资源/Vite)   | |  (静态资源/Vite)   |
+--------------------+ +------------------+ +------------------+
           |                   |                   |
           +-------------------+-------------------+
                               |
                      +--------v---------+
                      |   API网关        |
                      |  (可选)          |
                      +--------+---------+
                               |
           +-------------------+-------------------+
           |                   |                   |
+----------v---------+ +-------v---------+ +--------v---------+
|  Go后端服务1       | |  Go后端服务2     | |  Go后端服务N     |
|  (业务逻辑)        | |  (业务逻辑)      | |  (业务逻辑)      |
+--------------------+ +------------------+ +------------------+
           |                   |                   |
           +-------------------+-------------------+
                               |
           +-------------------+-------------------+
           |                   |                   |
+----------v---------+ +-------v---------+
|    MySQL主库      | |    Redis集群     |
|  (数据存储)       | |  (缓存/会话)     |
+----------+---------+ +------------------+
           |
+----------v---------+
|    MySQL从库      |
|  (读写分离)       |
+------------------+
```

## 2. 详细设计

### 2.1 系统类图

```
用户模块
+------------------+         +------------------+
|       User       |         |    UserService   |
+------------------+         +------------------+
| - user_id: long  |         | + Login()        |
| - username: str  |<------->| + Register()     |
| - password: str  |         | + GetUserInfo()  |
| - user_type: int |         | + UpdateUser()   |
+------------------+         +------------------+

社团模块
+------------------+         +------------------+
|       Club       |         |    ClubService   |
+------------------+         +------------------+
| - club_id: long  |         | + CreateClub()   |
| - club_name: str |<------->| + JoinClub()     |
| - status: int    |         | + GetClubList()  |
| - created_by: long|        | + UpdateClub()   |
+------------------+         +------------------+

活动模块
+------------------+         +------------------+
|    Activity      |         | ActivityService  |
+------------------+         +------------------+
| - activity_id: long |      | + CreateActivity()|
| - title: str     |<------->| + JoinActivity() |
| - club_id: long  |         | + GetActivityList()|
| - status: int    |         | + UpdateActivity()|
+------------------+         +------------------+

消息模块
+------------------+         +------------------+
|      Message     |         |  MessageService  |
+------------------+         +------------------+
| - message_id: long|        | + SendMessage()  |
| - receiver_id: long|       | + GetMessageList()|
| - content: str   |<------->| + MarkRead()     |
| - status: int    |         | + DeleteMessage()|
+------------------+         +------------------+
```

### 2.2 接口设计

#### 用户模块接口

| 接口路径              | 方法   | 模块/文件                 | 类型     | 功能描述     | 请求体 (JSON)                                                | 成功响应 (200 OK)                        |
| :-------------------- | :----- | :------------------------ | :------- | :----------- | :----------------------------------------------------------- | :--------------------------------------- |
| `/api/users/login`    | `POST` | `web_server/api/users.go` | `Router` | 用户登录     | `{"username": "...", "password": "..."}`                     | `{"token": "...", "user": {...}}`        |
| `/api/users/register` | `POST` | `web_server/api/users.go` | `Router` | 用户注册     | `{"username": "...", "password": "...", "student_id": "..."}` | `{"user_id": 1, "username": "..."}`      |
| `/api/users/info`     | `GET`  | `web_server/api/users.go` | `Router` | 获取用户信息 | N/A                                                          | `{"user_id": 1, "username": "...", ...}` |
| `/api/users/update`   | `PUT`  | `web_server/api/users.go` | `Router` | 更新用户信息 | `{"phone": "...", "email": "..."}`                           | `{"user_id": 1, "username": "...", ...}` |

#### 社团模块接口

| 接口路径                 | 方法   | 模块/文件                 | 类型     | 功能描述         | 请求体 (JSON)                                | 成功响应 (200 OK)                                     |
| :----------------------- | :----- | :------------------------ | :------- | :--------------- | :------------------------------------------- | :---------------------------------------------------- |
| `/api/clubs`             | `GET`  | `web_server/api/clubs.go` | `Router` | 获取社团列表     | N/A                                          | `[{"club_id": 1, "club_name": "...", ...}]`           |
| `/api/clubs`             | `POST` | `web_server/api/clubs.go` | `Router` | 创建社团         | `{"club_name": "...", "description": "..."}` | `{"club_id": 1, "club_name": "...", ...}`             |
| `/api/clubs/:id`         | `GET`  | `web_server/api/clubs.go` | `Router` | 获取社团详情     | N/A                                          | `{"club_id": 1, "club_name": "...", ...}`             |
| `/api/clubs/:id`         | `PUT`  | `web_server/api/clubs.go` | `Router` | 更新社团信息     | `{"club_name": "...", "description": "..."}` | `{"club_id": 1, "club_name": "...", ...}`             |
| `/api/clubs/:id/join`    | `POST` | `web_server/api/clubs.go` | `Router` | 加入社团         | N/A                                          | `{"status": "success", "message": "..."}`             |
| `/api/clubs/:id/members` | `GET`  | `web_server/api/clubs.go` | `Router` | 获取社团成员列表 | N/A                                          | `[{"user_id": 1, "username": "...", "role": 0, ...}]` |

#### 活动模块接口

| 接口路径                           | 方法   | 模块/文件                      | 类型     | 功能描述           | 请求体 (JSON)                                      | 成功响应 (200 OK)                                       |
| :--------------------------------- | :----- | :----------------------------- | :------- | :----------------- | :------------------------------------------------- | :------------------------------------------------------ |
| `/api/activities`                  | `GET`  | `web_server/api/activities.go` | `Router` | 获取活动列表       | N/A                                                | `[{"activity_id": 1, "title": "...", ...}]`             |
| `/api/activities`                  | `POST` | `web_server/api/activities.go` | `Router` | 创建活动           | `{"title": "...", "content": "...", "club_id": 1}` | `{"activity_id": 1, "title": "...", ...}`               |
| `/api/activities/:id`              | `GET`  | `web_server/api/activities.go` | `Router` | 获取活动详情       | N/A                                                | `{"activity_id": 1, "title": "...", ...}`               |
| `/api/activities/:id`              | `PUT`  | `web_server/api/activities.go` | `Router` | 更新活动信息       | `{"title": "...", "content": "..."}`               | `{"activity_id": 1, "title": "...", ...}`               |
| `/api/activities/:id/join`         | `POST` | `web_server/api/activities.go` | `Router` | 报名参加活动       | N/A                                                | `{"status": "success", "message": "..."}`               |
| `/api/activities/:id/participants` | `GET`  | `web_server/api/activities.go` | `Router` | 获取活动参与者列表 | N/A                                                | `[{"user_id": 1, "username": "...", "status": 1, ...}]` |

#### 消息模块接口

| 接口路径                 | 方法     | 模块/文件                    | 类型     | 功能描述     | 请求体 (JSON)                          | 成功响应 (200 OK)                            |
| :----------------------- | :------- | :--------------------------- | :------- | :----------- | :------------------------------------- | :------------------------------------------- |
| `/api/messages`          | `GET`    | `web_server/api/messages.go` | `Router` | 获取消息列表 | N/A                                    | `[{"message_id": 1, "content": "...", ...}]` |
| `/api/messages`          | `POST`   | `web_server/api/messages.go` | `Router` | 发送消息     | `{"receiver_id": 1, "content": "..."}` | `{"message_id": 1, "content": "...", ...}`   |
| `/api/messages/:id/read` | `PUT`    | `web_server/api/messages.go` | `Router` | 标记消息已读 | N/A                                    | `{"status": "success"}`                      |
| `/api/messages/:id`      | `DELETE` | `web_server/api/messages.go` | `Router` | 删除消息     | N/A                                    | `{"status": "success"}`                      |

### 2.3 重要功能的顺序图

#### 用户登录流程

```
客户端          API层          服务层          数据层
  |              |              |              |
  | POST /login  |              |              |
  |------------->|              |              |
  |              | 验证参数     |              |
  |              |------------->|              |
  |              |              | 查询用户     |
  |              |              |------------->|
  |              |              |              |
  |              |              | 验证密码     |
  |              |              |<-------------|
  |              | 生成Token    |              |
  |              |<-------------|              |
  | 返回登录结果  |              |              |
  |<-------------|              |              |
```

#### 社团创建流程

```
客户端          API层          服务层          数据层
  |              |              |              |
  | POST /clubs  |              |              |
  |------------->|              |              |
  |              | 验证Token    |              |
  |              |------------->|              |
  |              |              | 验证用户权限  |
  |              |              |------------->|
  |              |              |              |
  |              |              | 创建社团记录  |
  |              |              |------------->|
  |              |              |              |
  |              |              | 设置创建者为会长|
  |              |              |------------->|
  |              | 返回创建结果  |              |
  |              |<-------------|              |
  |<-------------|              |              |
```

#### 活动报名流程

```
客户端          API层          服务层          数据层
  |              |              |              |
  | POST /activities/:id/join | |              |
  |-------------------------->|              |
  |              | 验证Token    |              |
  |              |------------->|              |
  |              |              | 检查活动状态  |
  |              |              |------------->|
  |              |              |              |
  |              |              | 检查参与人数  |
  |              |              |------------->|
  |              |              |              |
  |              |              | 创建参与记录  |
  |              |              |------------->|
  |              | 返回报名结果  |              |
  |              |<-------------|              |
  |<-------------|              |              |
```

### 2.4 重要功能的状态图

#### 社团状态流转

```
                  +----------------+    审核通过    +----------------+
  创建社团  ------>|   待审核状态   | ------------->|   正常运营状态  |
                  +----------------+               +----------------+
                          |                             |
                          | 审核不通过                  | 违规/到期
                          v                             v
                  +----------------+    重新申请    +----------------+
                  |   已拒绝状态   | <-------------|    已禁用状态   |
                  +----------------+               +----------------+
```

#### 活动状态流转

```
                  +----------------+    提交审核    +----------------+
  创建草稿  ------>|    草稿状态    | ------------->|   待审核状态   |
                  +----------------+               +----------------+
                          |                             |
                          | 保存修改                    | 审核通过
                          v                             v
                  +----------------+               +----------------+
                  |    已取消状态   | <-------------|   进行中状态   |
                  +----------------+    提前结束     +----------------+
                                                     |
                                                     | 活动结束
                                                     v
                                               +----------------+
                                               |    已结束状态   |
                                               +----------------+
```

## 3. 总结

本设计文档详细描述了社团管理系统的技术架构、数据模型和接口设计。系统采用前后端分离的架构，前端使用Vue 3和uni-app，后端使用Go语言，数据库选择MySQL。系统主要包含用户管理、社团管理、活动管理和消息通知等核心功能模块。

在后续的开发中，应优先实现用户认证、社团管理等基础功能，然后逐步扩展活动管理、消息通知等功能模块。同时，需要注意系统的安全性、性能优化和用户体验，确保系统稳定可靠地运行。

**文档版本**: v1.0  
**编写日期**: 2025年  
**适用迭代**: 迭代一（基本功能实现阶段）